[package]
name = "ewm-core"
version = "0.1.0"
edition = "2021"
license = "GPL-3.0-or-later"
description = "Emacs Wayland Manager - Wayland compositor"

[lib]
name = "ewm_core"
path = "src/lib.rs"
# cdylib for Emacs module, rlib for tests
crate-type = ["cdylib", "rlib"]

[dependencies]
anyhow = "1.0.100"
libc = "0.2.180"
serde = { version = "1.0.228", features = ["derive"] }
serde_json = "1.0.149"
tracing = { version = "0.1.44", features = ["max_level_trace", "release_max_level_debug"] }
tracing-subscriber = { version = "=0.3.19", features = ["env-filter"] }
tracing-journald = "0.3"

[dependencies.smithay]
git = "https://github.com/Smithay/smithay.git"
rev = "ae14fa12f6ee3fc4dd4c766ffb21848f991a6a18"
default-features = false
features = [
    "backend_drm",
    "backend_egl",
    "backend_gbm",
    "backend_libinput",
    "backend_udev",
    "backend_session_libseat",
    "desktop",
    "renderer_gl",
    "renderer_multi",
    "use_system_lib",
    "wayland_frontend",
]

[dependencies.smithay-drm-extras]
git = "https://github.com/Smithay/smithay.git"
rev = "ae14fa12f6ee3fc4dd4c766ffb21848f991a6a18"
default-features = false

# PipeWire for screen sharing (optional)
[dependencies.pipewire]
version = "0.9.2"
optional = true
features = ["v0_3_33"]

[dependencies.zbus]
version = "5.13.0"
optional = true

[dependencies.async-io]
version = "2.6.0"
optional = true

[dependencies.sd-notify]
version = "0.4.5"

# Wayland client (for self-connecting as input method)
[dependencies.wayland-client]
version = "0.31.12"

[dependencies.wayland-protocols-misc]
version = "0.3"
features = ["client"]

# GIO for XDG desktop app enumeration
[dependencies.gio]
version = "0.20"

# Emacs dynamic module support
[dependencies.emacs]
version = "0.19"

[features]
default = []
screencast = ["pipewire", "zbus", "async-io"]

# Tracy profiling support
profile-with-tracy = ["tracy-client/default"]
profile-with-tracy-ondemand = ["profile-with-tracy", "tracy-client/ondemand"]

[dependencies.tracy-client]
version = "0.18.4"
default-features = false
optional = true

[dev-dependencies]
insta = { version = "1.46.0", features = ["yaml"] }
proptest = "1.9.0"
